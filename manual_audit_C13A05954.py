#!/usr/bin/env python3
"""
手動修正C13A05954的檢核
"""

from tender_audit_system import TenderComplianceValidator
import json
from datetime import datetime

def manual_audit_C13A05954():
    """手動提供正確的資料進行檢核"""
    
    # 手動修正的招標公告資料
    announcement_data = {
        "案號": "C13A05954",
        "案名": "電梯門機構皮帶傳動輪組等3項採購",
        "招標方式": "公開取得報價或企劃書",
        "採購金額": 390000,  # 39萬
        "預算金額": 390000,
        "採購金級距": "未達公告金額",
        "依據法條": "政府採購法第49條",
        "決標方式": "最低標",
        "訂有底價": "是",
        "複數決標": "否",
        "依64條之2": "否",
        "標的分類": "財物",
        "適用條約": "否",  # 根據實際內容判斷
        "敏感性採購": "否",
        "國安採購": "否",
        "增購權利": "是",  # 須知有保留增購
        "特殊採購": "否",
        "統包": "否",
        "協商措施": "否",
        "電子領標": "是",
        "優先身障": "否",
        "外國廠商": "可",
        "限定中小企業": "否",
        "押標金": 39000,  # 3.9萬
        "開標方式": "一次投標不分段開標"
    }
    
    # 投標須知資料（從之前提取的結果）
    requirements_data = {
        "採購標的名稱": "電梯門機構皮帶傳動輪組等3項採購",
        "案號": "C13A05954",
        "第3點逾公告金額十分之一": "已勾選",
        "第4點非特殊採購": "已勾選",
        "第5點逾公告金額十分之一": "已勾選",
        "第6點訂底價": "已勾選",
        "第7點保留增購": "已勾選",
        "第7點未保留增購": "已勾選",  # 這個有問題，兩個都勾選
        "第8點條約協定": "已勾選",  # 這個有問題
        "第8點可參與": "已勾選",
        "第8點不可參與": "已勾選",  # 這個有問題，兩個都勾選
        "第8點禁止大陸": "已勾選",
        "第9點電子領標": "已勾選",
        "第13點敏感性": "已勾選",  # 可能有問題
        "第13點國安": "已勾選",  # 可能有問題
        "第19點無需押標金": "未勾選",
        "第19點一定金額": "未勾選",  # 這個有問題，應該勾選
        "第35點非統包": "已勾選",
        "第42點不分段": "已勾選",
        "第42點分二段": "已勾選",  # 這個有問題，兩個都勾選
        "第54點不協商": "已勾選",
        "第59點最低標": "已勾選",
        "第59點非64條之2": "已勾選",
        "第59點身障優先": "已勾選",  # 可能有問題
        "押標金金額": 5000  # 這個有問題，應該是39000
    }
    
    # 執行驗證
    validator = TenderComplianceValidator()
    result = validator.validate_all(announcement_data, requirements_data)
    
    print("📊 手動修正後的檢核結果:")
    print(f"通過率: {result['通過數']}/{result['總項次']} = {result['通過數']/result['總項次']*100:.1f}%")
    print(f"審核結果: {result['審核結果']}")
    
    if result["失敗數"] > 0:
        print("\n❌ 仍存在的問題:")
        for error in result["錯誤詳情"]:
            print(f"  項次{error['項次']}: {error['說明']}")
    
    # 分析問題
    print("\n🔍 問題分析:")
    print("1. 押標金不一致：公告39,000 vs 須知5,000")
    print("2. 條約協定：公告說不適用，須知卻勾選適用")
    print("3. 多個矛盾的勾選項目（保留/未保留增購、可/不可參與等）")
    
    return result

if __name__ == "__main__":
    manual_audit_C13A05954()