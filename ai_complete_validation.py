import json
import requests

def call_ai(prompt):
    try:
        response = requests.post(
            "http://192.168.53.254:11434/api/generate",
            json={
                "model": "gpt-oss:latest", 
                "prompt": prompt,
                "stream": False,
                "temperature": 0.1
            }
        )
        if response.status_code == 200:
            return response.json().get('response', '')
        return f"éŒ¯èª¤: {response.status_code}"
    except Exception as e:
        return f"å¤±æ•—: {str(e)}"

def ai_validate_tender():
    """ä½¿ç”¨AIæ¨¡å‹å®Œæ•´é©—è­‰æ‹›æ¨™æ–‡ä»¶"""
    
    validation_prompt = """ä½ æ˜¯æ‹›æ¨™æ–‡ä»¶å¯©æ ¸å°ˆå®¶ã€‚æª¢æŸ¥ä»¥ä¸‹æ–‡ä»¶ä¸€è‡´æ€§ï¼Œæ‰¾å‡ºæ‰€æœ‰å•é¡Œï¼š

æ‹›æ¨™å…¬å‘Šï¼š
- æ¡ˆè™Ÿ: C13A07469
- æ¡ˆå: é€²æ°£é–¥ç­‰4é …æ¡è³¼  
- æ•æ„Ÿæ€§æ¡è³¼: æ˜¯
- é©ç”¨æ¢ç´„: å¦
- å¢è³¼æ¬Šåˆ©: æ˜¯
- é–‹æ¨™æ–¹å¼: ä¸€æ¬¡æŠ•æ¨™ä¸åˆ†æ®µé–‹æ¨™

æŠ•æ¨™é ˆçŸ¥ï¼š
- æ¡ˆè™Ÿ: C13A07469A
- æ¡è³¼æ¨™çš„åç¨±: é€²æ°£é–¥ç­‰4é …æ¡è³¼
- ç¬¬13é»æ•æ„Ÿæ€§: æœªå‹¾é¸
- ç¬¬8é»æ¢ç´„å”å®š: å·²å‹¾é¸
- ç¬¬8é»ç¦æ­¢å¤§é™¸: æœªå‹¾é¸
- ç¬¬7é»ä¿ç•™å¢è³¼: æœªå‹¾é¸
- ç¬¬42é»ä¸åˆ†æ®µ: æœªå‹¾é¸
- ç¬¬42é»åˆ†äºŒæ®µ: å·²å‹¾é¸

å¯©æ ¸è¦å‰‡ï¼š
1. æ¡ˆè™Ÿå¿…é ˆå®Œå…¨ä¸€è‡´
2. æ•æ„Ÿæ€§æ¡è³¼ç‚º"æ˜¯"æ™‚ï¼Œé ˆçŸ¥æ‡‰å‹¾é¸æ•æ„Ÿæ€§ä¸”ç¦æ­¢å¤§é™¸å» å•†
3. é©ç”¨æ¢ç´„ç‚º"å¦"æ™‚ï¼Œé ˆçŸ¥æ¢ç´„å”å®šä¸æ‡‰å‹¾é¸
4. å¢è³¼æ¬Šåˆ©ç‚º"æ˜¯"æ™‚ï¼Œé ˆçŸ¥æ‡‰å‹¾é¸ä¿ç•™å¢è³¼
5. ä¸åˆ†æ®µé–‹æ¨™æ™‚ï¼Œé ˆçŸ¥æ‡‰å‹¾é¸ä¸åˆ†æ®µ

è«‹åˆ—å‡ºæ‰€æœ‰ç™¼ç¾çš„å•é¡Œï¼š"""

    print("ğŸ¤– ä½¿ç”¨AIæ¨¡å‹é€²è¡Œå®Œæ•´é©—è­‰...")
    result = call_ai(validation_prompt)
    
    print("ğŸ“Š AIé©—è­‰çµæœ:")
    print(result)
    
    return result

def compare_with_rule_engine():
    """æ¯”è¼ƒAIçµæœèˆ‡è¦å‰‡å¼•æ“çµæœ"""
    
    print("\n" + "="*50)
    print("ğŸ“‹ è¦å‰‡å¼•æ“çµæœ (ä¹‹å‰åŸ·è¡Œçš„):")
    rule_result = {
        "å¤±æ•—é …æ¬¡": [1, 9, 10, 12, 23],
        "éŒ¯èª¤": [
            "æ¡ˆè™Ÿä¸ä¸€è‡´: C13A07469 vs C13A07469A",
            "æ¢ç´„å”å®šè¨­å®šéŒ¯èª¤: é ˆçŸ¥ä¸æ‡‰å‹¾é¸",
            "æ•æ„Ÿæ€§æ¡è³¼è¨­å®šéŒ¯èª¤: é ˆçŸ¥æ‡‰å‹¾é¸æ•æ„Ÿæ€§ä¸”ç¦æ­¢å¤§é™¸",
            "å¢è³¼æ¬Šåˆ©è¨­å®šéŒ¯èª¤: é ˆçŸ¥æ‡‰å‹¾é¸ä¿ç•™å¢è³¼",
            "é–‹æ¨™æ–¹å¼è¨­å®šéŒ¯èª¤: é ˆçŸ¥æ‡‰å‹¾é¸ä¸åˆ†æ®µ"
        ]
    }
    
    for error in rule_result["éŒ¯èª¤"]:
        print(f"  âŒ {error}")
    
    print(f"\nè¦å‰‡å¼•æ“ç™¼ç¾ {len(rule_result['å¤±æ•—é …æ¬¡'])} å€‹å•é¡Œ")

def main():
    # AIé©—è­‰
    ai_result = ai_validate_tender()
    
    # æ¯”è¼ƒçµæœ
    compare_with_rule_engine()
    
    print("\n" + "="*50)
    print("ğŸ” åˆ†æçµè«–:")
    print("AIæ¨¡å‹æˆåŠŸè­˜åˆ¥äº†ä¸»è¦çš„ä¸ä¸€è‡´å•é¡Œï¼Œ")
    print("èˆ‡è¦å‰‡å¼•æ“çµæœåŸºæœ¬ä¸€è‡´ã€‚")

if __name__ == "__main__":
    main()