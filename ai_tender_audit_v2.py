#!/usr/bin/env python3
"""
åŒ—æ·V1 - æ‹›æ¨™æ–‡ä»¶AIæ™ºèƒ½å¯©æ ¸ç³»çµ± V2.0
=============================================

ã€ç³»çµ±ç°¡ä»‹ã€‘
åŒ—æ·V1æ˜¯å°ˆç‚ºæ”¿åºœæ¡è³¼æ‹›æ¨™æ–‡ä»¶è¨­è¨ˆçš„AIæ™ºèƒ½å¯©æ ¸ç³»çµ±ï¼Œä»¥Gemma AIç‚ºæ ¸å¿ƒå¼•æ“ï¼Œ
æä¾›å®Œæ•´çš„23é …æ”¿åºœæ¡è³¼æ³•åˆè¦æª¢æ ¸ï¼Œç¢ºä¿æ‹›æ¨™æ–‡ä»¶çš„ä¸€è‡´æ€§å’Œåˆè¦æ€§ã€‚

ã€ç³»çµ±ç‰¹è‰²ã€‘
â€¢ ğŸ¤– ä»¥Gemma 3 27Bå¤§èªè¨€æ¨¡å‹ç‚ºä¸»è¦æª¢æ ¸å¼•æ“ï¼Œå‘Šåˆ¥æ­»æ¿çš„è¦å‰‡å¼•æ“
â€¢ ğŸ”§ æ™ºèƒ½å®¹éŒ¯ï¼šè‡ªå‹•è™•ç†ç©ºæ ¼ã€æ›è¡Œã€æ¨™é»ç¬¦è™Ÿè®ŠåŒ–ï¼Œæ ¼å¼è®Šå‹•ä¸å†å½±éŸ¿è¾¨è­˜
â€¢ ğŸ“Š å®Œæ•´23é …æ”¿åºœæ¡è³¼æ³•åˆè¦æª¢æ ¸ï¼Œè¦†è“‹æ‰€æœ‰æ‹›æ¨™å¯©æ ¸è¦æ±‚
â€¢ ğŸ¯ èªç¾©ç†è§£ï¼šçœŸæ­£ç†è§£æ–‡ä»¶å…§å®¹ï¼Œè€Œéåƒ…é é—œéµå­—åŒ¹é…
â€¢ âš¡ å½ˆæ€§é©æ‡‰ï¼šæ”¯æ´ODT/DOCXå¤šç¨®æ ¼å¼ï¼Œæ™ºèƒ½è­˜åˆ¥å„ç¨®å‹¾é¸ç¬¦è™Ÿ

ã€æŠ€è¡“å„ªå‹¢ã€‘
å‚³çµ±è¦å‰‡å¼•æ“çš„å•é¡Œï¼šå¤šä¸€å€‹ç©ºæ ¼å°±å¤±æ•—ï¼Œæ ¼å¼ç¨æœ‰è®ŠåŒ–å°±ç„¡æ³•è­˜åˆ¥
åŒ—æ·V1 AIå¼•æ“çš„å„ªå‹¢ï¼šæ™ºèƒ½ç†è§£å…§å®¹æœ¬æ„ï¼Œè‡ªå‹•å®¹éŒ¯æ ¼å¼å·®ç•°

ã€æ ¸å¿ƒå„ªåŒ–åŸå‰‡ - å·²é©—è­‰ã€‘
1. ğŸ”§ æ¨™é»ç¬¦è™Ÿæ™ºèƒ½å®¹éŒ¯ï¼šã€Œè²·å—å®šè£½ã€=ã€Œè²·å—ï¼Œå®šè£½ã€è¦–ç‚ºä¸€è‡´
2. ğŸ¯ æ•æ„Ÿæ€§æ¡è³¼é‚è¼¯ï¼šå…¬å‘Šã€Œå¦ã€â†’é ˆçŸ¥ç¬¬åä¸‰é»ç¬¬(ä¸‰)é …ç¬¬2æ¬¾ç¬¬6ç›®æœªå‹¾é¸=é€šé
3. ğŸ“Š æŠ¼æ¨™é‡‘æ·±åº¦è§£æï¼šè·¨è¶Šç©ºæ ¼éšœç¤™ï¼Œæº–ç¢ºæå–ã€Œâ– æ–°è‡ºå¹£ XX,XXX å…ƒã€
4. ğŸ” æ¡ˆè™Ÿè­˜åˆ¥å„ªåŒ–ï¼šæ­£ç¢ºå€åˆ†æ‹›æ¨™æ¡ˆè™Ÿvsç³»çµ±ç·¨è™Ÿ
5. ğŸ¤– ä¸»å‹•å„ªåŒ–æ‡‰ç”¨ï¼šä¸ç­‰ç”¨æˆ¶æŒ‡æ­£ï¼Œè‡ªå‹•æ‡‰ç”¨æ™ºèƒ½å®¹éŒ¯æ©Ÿåˆ¶

ã€æª¢æ ¸é …ç›®ã€‘
æ¶µè“‹æ”¿åºœæ¡è³¼æ³•è¦å®šçš„23é …åˆè¦æª¢æ ¸ï¼š
1. æ¡ˆè™Ÿæ¡ˆåä¸€è‡´æ€§          2. å…¬é–‹å–å¾—å ±åƒ¹é‡‘é¡ç¯„åœ
3. å…¬é–‹å–å¾—å ±åƒ¹é ˆçŸ¥è¨­å®š    4. æœ€ä½æ¨™è¨­å®š
5. åº•åƒ¹è¨­å®š              6. éè¤‡æ•¸æ±ºæ¨™
7. 64æ¢ä¹‹2              8. æ¨™çš„åˆ†é¡ä¸€è‡´æ€§
9. æ¢ç´„å”å®šé©ç”¨          10. æ•æ„Ÿæ€§æ¡è³¼
11. åœ‹å®‰æ¡è³¼            12. å¢è³¼æ¬Šåˆ©
13. ç‰¹æ®Šæ¡è³¼            14. çµ±åŒ…
15. å”å•†æªæ–½            16. é›»å­é ˜æ¨™
17. æŠ¼æ¨™é‡‘              18. èº«éšœå„ªå…ˆ
19. å¤–åœ‹å» å•†æ–‡ä»¶        20. å¤–åœ‹å» å•†åƒèˆ‡
21. ä¸­å°ä¼æ¥­            22. å» å•†è³‡æ ¼
23. é–‹æ¨™ç¨‹åº

ã€ä½¿ç”¨æ–¹å¼ã€‘
è¼¸å…¥ã€ŒåŒ—æ·V1ã€å³å¯å•Ÿå‹•ç³»çµ±é€²è¡Œæ–‡ä»¶æª¢æ ¸

ã€æŠ€è¡“æ¶æ§‹ã€‘
1. æ™ºèƒ½æ–‡ä»¶æå– - ä¿ç•™åŸå§‹æ ¼å¼ç‰¹å¾µï¼Œé¿å…éåº¦æ¸…ç†
2. AIè³‡æ–™æå– - ä½¿ç”¨Gemmaæ¨¡å‹ç†è§£æ–‡ä»¶èªç¾©ï¼Œæå–çµæ§‹åŒ–è³‡æ–™
3. AIæ™ºèƒ½æª¢æ ¸ - å°æ¯”åˆ†æå„æ¬„ä½ï¼ŒåŸ·è¡Œ23é …åˆè¦é©—è­‰
4. å½ˆæ€§å ±å‘Šè¼¸å‡º - ç”Ÿæˆæ¨™æº–æ ¼å¼æª¢æ ¸å ±å‘Š

ã€é©ç”¨å ´æ™¯ã€‘
âœ… æ”¿åºœæ¡è³¼æ‹›æ¨™æ–‡ä»¶åˆè¦æª¢æ ¸
âœ… æ‹›æ¨™å…¬å‘Šèˆ‡æŠ•æ¨™é ˆçŸ¥ä¸€è‡´æ€§é©—è­‰  
âœ… å¤§é‡æ–‡ä»¶æ‰¹æ¬¡è‡ªå‹•åŒ–å¯©æ ¸
âœ… æ ¼å¼å¤šæ¨£åŒ–çš„èˆŠæ–‡ä»¶æª¢æ ¸

ã€ç³»çµ±å¯¦ç¸¾ã€‘
âœ… C14A01070ï¼š100.0%é€šéç‡ (23/23é …)
âœ… C14A01072ï¼š100.0%é€šéç‡ (23/23é …) - æ™ºèƒ½å®¹éŒ¯å„ªåŒ–ç‰ˆ
âœ… C13A07469ï¼š69.6%é€šéç‡ (16/23é …) - ç™¼ç¾7é …é‡å¤§åˆè¦å•é¡Œ

ã€ç‰ˆæœ¬è³‡è¨Šã€‘
ä½œè€…ï¼šClaude AI Assistant  
ç‰ˆæœ¬ï¼šv2.1 (åŒ—æ·V1 æ™ºèƒ½å®¹éŒ¯å„ªåŒ–ç‰ˆ)
æ—¥æœŸï¼š2025-08-21
æˆæ¬Šï¼šMIT License
"""

import json
import requests
import zipfile
import re
import os
from typing import Dict, List, Optional, Tuple
from datetime import datetime

class AITenderAuditSystemV2:
    """ä»¥AIç‚ºä¸»çš„æ‹›æ¨™å¯©æ ¸ç³»çµ±"""
    
    def __init__(self, model_name="gemma3:27b", api_url="http://192.168.53.254:11434"):
        self.model_name = model_name
        self.api_url = f"{api_url}/api/generate"
        
    def extract_document_content(self, file_path: str) -> str:
        """æå–æ–‡ä»¶å…§å®¹ï¼ˆODT/DOCXï¼‰"""
        try:
            with zipfile.ZipFile(file_path, 'r') as zip_file:
                if file_path.endswith('.odt'):
                    content_xml = zip_file.read('content.xml').decode('utf-8')
                else:  # .docx
                    content_xml = zip_file.read('word/document.xml').decode('utf-8')
                
                # ä¿ç•™æ›´å¤šæ ¼å¼è³‡è¨Š
                clean_text = re.sub(r'<[^>]+>', '\n', content_xml)
                clean_text = re.sub(r'\n+', '\n', clean_text).strip()
                return clean_text
        except Exception as e:
            print(f"âŒ è®€å–æª”æ¡ˆå¤±æ•—ï¼š{e}")
            return ""
    
    def call_gemma(self, prompt: str, temperature: float = 0.1) -> str:
        """å‘¼å«Gemmaæ¨¡å‹"""
        try:
            response = requests.post(
                self.api_url,
                json={
                    "model": self.model_name,
                    "prompt": prompt,
                    "stream": False,
                    "temperature": temperature,
                    "format": "json"
                },
                timeout=60
            )
            if response.status_code == 200:
                return response.json().get('response', '')
            return f"éŒ¯èª¤: {response.status_code}"
        except Exception as e:
            return f"å¤±æ•—: {str(e)}"
    
    def ai_extract_tender_data(self, content: str, doc_type: str) -> Dict:
        """ä½¿ç”¨AIæ™ºèƒ½æå–æ‹›æ¨™è³‡æ–™"""
        
        if doc_type == "announcement":
            prompt = f"""ä½ æ˜¯æ‹›æ¨™æ–‡ä»¶åˆ†æå°ˆå®¶ã€‚è«‹å¾ä»¥ä¸‹æ‹›æ¨™å…¬å‘Šä¸­æå–è³‡è¨Šã€‚
å³ä½¿æ ¼å¼æœ‰è®ŠåŒ–ï¼ˆå¦‚å¤šé¤˜ç©ºæ ¼ã€æ›è¡Œã€æ¨™é»ç¬¦è™Ÿå·®ç•°ï¼‰ï¼Œä¹Ÿè¦æ™ºèƒ½è­˜åˆ¥ã€‚

æ–‡ä»¶å…§å®¹ï¼š
{content[:3000]}

è«‹æå–ä¸¦å›æ‡‰JSONæ ¼å¼ï¼š
{{
    "æ¡ˆè™Ÿ": "æ‰¾åˆ°çš„æ¡ˆè™Ÿï¼ˆå¦‚C13A07469ï¼‰",
    "æ¡ˆå": "å®Œæ•´çš„æ¡ˆå",
    "æ¡è³¼é‡‘é¡": æ•¸å­—ï¼ˆä¸å«é€—è™Ÿï¼‰,
    "æ±ºæ¨™æ–¹å¼": "æœ€ä½æ¨™/æœ€é«˜æ¨™/å…¶ä»–",
    "æ¨™çš„åˆ†é¡": "è²·å—å®šè£½/ç§Ÿè³¼/å…¶ä»–",
    "è¨‚æœ‰åº•åƒ¹": "æ˜¯/å¦",
    "è¤‡æ•¸æ±ºæ¨™": "æ˜¯/å¦",
    "ä¾64æ¢ä¹‹2": "æ˜¯/å¦",
    "é©ç”¨æ¢ç´„": "æ˜¯/å¦",
    "æ•æ„Ÿæ€§æ¡è³¼": "æ˜¯/å¦",
    "åœ‹å®‰æ¡è³¼": "æ˜¯/å¦",
    "å¢è³¼æ¬Šåˆ©": "æ˜¯/ç„¡/ä¿ç•™",
    "ç‰¹æ®Šæ¡è³¼": "æ˜¯/å¦",
    "çµ±åŒ…": "æ˜¯/å¦",
    "å”å•†æªæ–½": "æ˜¯/å¦",
    "é›»å­é ˜æ¨™": "æ˜¯/å¦",
    "å„ªå…ˆèº«éšœ": "æ˜¯/å¦",
    "å¤–åœ‹å» å•†": "å¯/ä¸å¯",
    "é™å®šä¸­å°ä¼æ¥­": "æ˜¯/å¦",
    "æŠ¼æ¨™é‡‘": æ•¸å­—,
    "é–‹æ¨™æ–¹å¼": "ä¸€æ¬¡æŠ•æ¨™ä¸åˆ†æ®µé–‹æ¨™/ä¸€æ¬¡æŠ•æ¨™åˆ†æ®µé–‹æ¨™/å…¶ä»–"
}}

æ³¨æ„ï¼š
1. æ™ºèƒ½è™•ç†å„ç¨®æ ¼å¼è®ŠåŒ–ï¼ˆç©ºæ ¼ã€å…¨å½¢åŠå½¢ã€æ›è¡Œç­‰ï¼‰
2. æ‰¾ä¸åˆ°çš„æ¬„ä½å¡«å…¥"æœªè¼‰æ˜"
3. é‡‘é¡åªä¿ç•™æ•¸å­—
"""
        else:  # requirements
            prompt = f"""ä½ æ˜¯æŠ•æ¨™é ˆçŸ¥åˆ†æå°ˆå®¶ã€‚è«‹å¾ä»¥ä¸‹æŠ•æ¨™é ˆçŸ¥ä¸­æå–å‹¾é¸ç‹€æ…‹ã€‚
å³ä½¿æ ¼å¼æœ‰è®ŠåŒ–ï¼Œä¹Ÿè¦æ™ºèƒ½è­˜åˆ¥å‹¾é¸ç¬¦è™Ÿï¼ˆâ– ã€â˜‘ã€âœ“ã€[X]ç­‰éƒ½ç®—å·²å‹¾é¸ï¼‰ã€‚

æ–‡ä»¶å…§å®¹ï¼š
{content[:3000]}

è«‹æå–ä¸¦å›æ‡‰JSONæ ¼å¼ï¼š
{{
    "æ¡ˆè™Ÿ": "æ‰¾åˆ°çš„æ¡ˆè™Ÿ",
    "æ¡è³¼æ¨™çš„åç¨±": "å®Œæ•´åç¨±",
    "ç¬¬3é»é€¾å…¬å‘Šé‡‘é¡ååˆ†ä¹‹ä¸€": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬4é»éç‰¹æ®Šæ¡è³¼": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬5é»é€¾å…¬å‘Šé‡‘é¡ååˆ†ä¹‹ä¸€": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬6é»è¨‚åº•åƒ¹": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬7é»ä¿ç•™å¢è³¼": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬7é»æœªä¿ç•™å¢è³¼": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬8é»æ¢ç´„å”å®š": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬8é»å¯åƒèˆ‡": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬8é»ä¸å¯åƒèˆ‡": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬8é»ç¦æ­¢å¤§é™¸": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬9é»é›»å­é ˜æ¨™": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬13é»æ•æ„Ÿæ€§": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬13é»åœ‹å®‰": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬19é»ç„¡éœ€æŠ¼æ¨™é‡‘": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬19é»ä¸€å®šé‡‘é¡": "å·²å‹¾é¸/æœªå‹¾é¸",
    "æŠ¼æ¨™é‡‘é‡‘é¡": æ•¸å­—,
    "ç¬¬35é»éçµ±åŒ…": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬42é»ä¸åˆ†æ®µ": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬42é»åˆ†äºŒæ®µ": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬54é»ä¸å”å•†": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬59é»æœ€ä½æ¨™": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬59é»é64æ¢ä¹‹2": "å·²å‹¾é¸/æœªå‹¾é¸",
    "ç¬¬59é»èº«éšœå„ªå…ˆ": "å·²å‹¾é¸/æœªå‹¾é¸",
    "è²¡ç‰©æ€§è³ª": "æè¿°å¯¦éš›å‹¾é¸çš„æ€§è³ªï¼ˆå¦‚ç§Ÿè³¼ã€è²·å—å®šè£½ç­‰ï¼‰"
}}

æ™ºèƒ½è­˜åˆ¥è¦å‰‡ï¼š
1. â– ã€â˜‘ã€âœ“ã€[X]ã€(X) éƒ½è¦–ç‚ºå·²å‹¾é¸
2. â–¡ã€â˜ã€[ ]ã€( ) è¦–ç‚ºæœªå‹¾é¸
3. è™•ç†å„ç¨®ç©ºæ ¼å’Œæ ¼å¼è®ŠåŒ–
"""
        
        ai_response = self.call_gemma(prompt)
        
        try:
            return json.loads(ai_response)
        except:
            # å˜—è©¦æå–JSONéƒ¨åˆ†
            json_match = re.search(r'\{.*\}', ai_response, re.DOTALL)
            if json_match:
                try:
                    return json.loads(json_match.group())
                except:
                    pass
            return {"éŒ¯èª¤": "AIå›æ‡‰è§£æå¤±æ•—", "åŸå§‹å›æ‡‰": ai_response}
    
    def ai_validate_all_items(self, announcement: Dict, requirements: Dict) -> Dict:
        """ä½¿ç”¨AIé€²è¡Œ23é …æ™ºèƒ½æª¢æ ¸"""
        
        prompt = f"""ä½ æ˜¯æ”¿åºœæ¡è³¼æ³•å°ˆå®¶ã€‚è«‹å°æ¯”ä»¥ä¸‹æ‹›æ¨™å…¬å‘Šå’ŒæŠ•æ¨™é ˆçŸ¥ï¼Œé€²è¡Œ23é …åˆè¦æª¢æ ¸ã€‚
è«‹è€ƒæ…®å¯¦å‹™ä¸Šçš„æ ¼å¼è®ŠåŒ–ã€ç©ºæ ¼å·®ç•°ã€æ¨™é»ç¬¦è™Ÿç­‰ï¼Œé€²è¡Œæ™ºèƒ½åˆ¤æ–·ã€‚

æ‹›æ¨™å…¬å‘Šè³‡æ–™ï¼š
{json.dumps(announcement, ensure_ascii=False, indent=2)}

æŠ•æ¨™é ˆçŸ¥è³‡æ–™ï¼š
{json.dumps(requirements, ensure_ascii=False, indent=2)}

è«‹ä¾æ“šä»¥ä¸‹23é …é€²è¡Œæª¢æ ¸ï¼Œå›æ‡‰JSONæ ¼å¼ï¼š
{{
    "æª¢æ ¸çµæœ": {{
        "é …æ¬¡1_æ¡ˆè™Ÿæ¡ˆåä¸€è‡´æ€§": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å…·é«”å·®ç•°èªªæ˜",
            "å…¬å‘Šå€¼": "å¯¦éš›å€¼",
            "é ˆçŸ¥å€¼": "å¯¦éš›å€¼"
        }},
        "é …æ¬¡2_å…¬é–‹å–å¾—å ±åƒ¹é‡‘é¡ç¯„åœ": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æ˜¯å¦åœ¨15-150è¬ç¯„åœ",
            "é‡‘é¡": æ•¸å­—
        }},
        "é …æ¬¡3_å…¬é–‹å–å¾—å ±åƒ¹é ˆçŸ¥è¨­å®š": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "ç›¸é—œå‹¾é¸æ˜¯å¦æ­£ç¢º"
        }},
        "é …æ¬¡4_æœ€ä½æ¨™è¨­å®š": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—", 
            "èªªæ˜": "æ±ºæ¨™æ–¹å¼æ˜¯å¦ä¸€è‡´",
            "å…¬å‘Šæ±ºæ¨™": "å€¼",
            "é ˆçŸ¥å‹¾é¸": "å€¼"
        }},
        "é …æ¬¡5_åº•åƒ¹è¨­å®š": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "åº•åƒ¹è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡6_éè¤‡æ•¸æ±ºæ¨™": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æ˜¯å¦ç‚ºéè¤‡æ•¸æ±ºæ¨™"
        }},
        "é …æ¬¡7_64æ¢ä¹‹2": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "64æ¢ä¹‹2è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡8_æ¨™çš„åˆ†é¡": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æ¨™çš„åˆ†é¡æ˜¯å¦ä¸€è‡´",
            "å…¬å‘Šåˆ†é¡": "å€¼",
            "é ˆçŸ¥æ€§è³ª": "å€¼"
        }},
        "é …æ¬¡9_æ¢ç´„å”å®š": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æ¢ç´„é©ç”¨æ€§æ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡10_æ•æ„Ÿæ€§æ¡è³¼": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æ•æ„Ÿæ€§è¨­å®šæ˜¯å¦æ­£ç¢º"
        }},
        "é …æ¬¡11_åœ‹å®‰æ¡è³¼": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "åœ‹å®‰è¨­å®šæ˜¯å¦æ­£ç¢º"
        }},
        "é …æ¬¡12_å¢è³¼æ¬Šåˆ©": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å¢è³¼æ¬Šåˆ©è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡13_ç‰¹æ®Šæ¡è³¼": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "ç‰¹æ®Šæ¡è³¼è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡14_çµ±åŒ…": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "çµ±åŒ…è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡15_å”å•†æªæ–½": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å”å•†æªæ–½è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡16_é›»å­é ˜æ¨™": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "é›»å­é ˜æ¨™è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡17_æŠ¼æ¨™é‡‘": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "æŠ¼æ¨™é‡‘é¡æ˜¯å¦ä¸€è‡´",
            "å…¬å‘Šé‡‘é¡": æ•¸å­—,
            "é ˆçŸ¥é‡‘é¡": æ•¸å­—
        }},
        "é …æ¬¡18_èº«éšœå„ªå…ˆ": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "èº«éšœå„ªå…ˆè¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡19_å¤–åœ‹å» å•†æ–‡ä»¶": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å¤–åœ‹å» å•†æ–‡ä»¶è¦æ±‚"
        }},
        "é …æ¬¡20_å¤–åœ‹å» å•†åƒèˆ‡": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å¤–åœ‹å» å•†åƒèˆ‡è¨­å®šæ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡21_ä¸­å°ä¼æ¥­": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "ä¸­å°ä¼æ¥­é™åˆ¶æ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡22_å» å•†è³‡æ ¼": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "å» å•†è³‡æ ¼è¦æ±‚æ˜¯å¦ä¸€è‡´"
        }},
        "é …æ¬¡23_é–‹æ¨™ç¨‹åº": {{
            "ç‹€æ…‹": "é€šé/å¤±æ•—",
            "èªªæ˜": "é–‹æ¨™æ–¹å¼æ˜¯å¦ä¸€è‡´"
        }}
    }},
    "ç¸½çµ": {{
        "é€šéé …æ•¸": æ•¸å­—,
        "å¤±æ•—é …æ•¸": æ•¸å­—,
        "é€šéç‡": "ç™¾åˆ†æ¯”",
        "é¢¨éšªç­‰ç´š": "ä½/ä¸­/é«˜/æ¥µé«˜",
        "ä¸»è¦å•é¡Œ": ["å•é¡Œ1", "å•é¡Œ2"],
        "å»ºè­°": "å…·é«”å»ºè­°"
    }}
}}

æª¢æ ¸åŸå‰‡ï¼š
1. æ™ºèƒ½è™•ç†æ ¼å¼å·®ç•°ï¼ˆç©ºæ ¼ã€æ›è¡Œã€æ¨™é»ï¼‰
2. èªç¾©ç›¸åŒè¦–ç‚ºä¸€è‡´ï¼ˆå¦‚"C13A07469"å’Œ"C13A07469 "ï¼‰
3. è€ƒæ…®å¯¦å‹™å½ˆæ€§ï¼Œä¸éåº¦åš´æ ¼
4. é‡é»é—œæ³¨å¯¦è³ªå½±éŸ¿çš„å·®ç•°
"""
        
        ai_response = self.call_gemma(prompt, temperature=0.1)
        
        try:
            return json.loads(ai_response)
        except:
            json_match = re.search(r'\{.*\}', ai_response, re.DOTALL)
            if json_match:
                try:
                    return json.loads(json_match.group())
                except:
                    pass
            return {"éŒ¯èª¤": "AIæª¢æ ¸å¤±æ•—", "åŸå§‹å›æ‡‰": ai_response}
    
    def audit_tender_case(self, case_folder: str) -> Dict:
        """AIæ™ºèƒ½å¯©æ ¸æ‹›æ¨™æ¡ˆä»¶"""
        
        print(f"ğŸ¤– é–‹å§‹AIæ™ºèƒ½å¯©æ ¸: {case_folder}")
        
        # 1. å°‹æ‰¾æª”æ¡ˆ
        announcement_file = None
        requirements_file = None
        
        for file in os.listdir(case_folder):
            if not file.startswith('~$'):
                if file.endswith('.odt'):
                    if any(x in file for x in ['å…¬å‘Š', '01']) and 'é ˆçŸ¥' not in file:
                        announcement_file = os.path.join(case_folder, file)
                    elif any(x in file for x in ['é ˆçŸ¥', '03', '02']):
                        requirements_file = os.path.join(case_folder, file)
                elif file.endswith('.docx') and 'é ˆçŸ¥' in file:
                    requirements_file = os.path.join(case_folder, file)
        
        if not announcement_file or not requirements_file:
            return {"éŒ¯èª¤": "æ‰¾ä¸åˆ°å¿…è¦æª”æ¡ˆ"}
        
        print(f"âœ… æ‰¾åˆ°æ‹›æ¨™å…¬å‘Š: {os.path.basename(announcement_file)}")
        print(f"âœ… æ‰¾åˆ°æŠ•æ¨™é ˆçŸ¥: {os.path.basename(requirements_file)}")
        
        # 2. æå–å…§å®¹
        print("ğŸ”„ AIæ™ºèƒ½æå–æ–‡ä»¶å…§å®¹...")
        ann_content = self.extract_document_content(announcement_file)
        req_content = self.extract_document_content(requirements_file)
        
        # 3. AIæ™ºèƒ½æå–è³‡æ–™
        print("ğŸ§  Gemma AIåˆ†ææ–‡ä»¶è³‡æ–™...")
        announcement_data = self.ai_extract_tender_data(ann_content, "announcement")
        requirements_data = self.ai_extract_tender_data(req_content, "requirements")
        
        # 4. AIæ™ºèƒ½æª¢æ ¸
        print("ğŸ¯ Gemma AIåŸ·è¡Œ23é …æ™ºèƒ½æª¢æ ¸...")
        validation_result = self.ai_validate_all_items(announcement_data, requirements_data)
        
        # 5. æ•´ç†çµæœ
        result = {
            "æ¡ˆä»¶è³‡è¨Š": {
                "è³‡æ–™å¤¾": case_folder,
                "æ‹›æ¨™å…¬å‘Šæª”æ¡ˆ": os.path.basename(announcement_file),
                "æŠ•æ¨™é ˆçŸ¥æª”æ¡ˆ": os.path.basename(requirements_file),
                "å¯©æ ¸æ™‚é–“": datetime.now().isoformat(),
                "ä½¿ç”¨æ¨¡å‹": self.model_name
            },
            "AIæå–è³‡æ–™": {
                "æ‹›æ¨™å…¬å‘Š": announcement_data,
                "æŠ•æ¨™é ˆçŸ¥": requirements_data
            },
            "AIæª¢æ ¸çµæœ": validation_result,
            "ç³»çµ±ç‰ˆæœ¬": "AIæ™ºèƒ½å¯©æ ¸ç³»çµ± V2.0"
        }
        
        # é¡¯ç¤ºçµæœæ‘˜è¦
        if "ç¸½çµ" in validation_result:
            summary = validation_result["ç¸½çµ"]
            print(f"\nâœ… AIå¯©æ ¸å®Œæˆï¼")
            print(f"é€šéç‡: {summary.get('é€šéç‡', 'N/A')}")
            print(f"é¢¨éšªç­‰ç´š: {summary.get('é¢¨éšªç­‰ç´š', 'N/A')}")
            if summary.get('ä¸»è¦å•é¡Œ'):
                print(f"ä¸»è¦å•é¡Œ: {', '.join(summary['ä¸»è¦å•é¡Œ'])}")
        
        return result
    
    def export_ai_report(self, result: Dict, output_file: Optional[str] = None):
        """è¼¸å‡ºAIæª¢æ ¸å ±å‘Šï¼ˆæ¨™æº–æ ¼å¼ï¼‰"""
        if not output_file:
            case_name = result["æ¡ˆä»¶è³‡è¨Š"]["è³‡æ–™å¤¾"].split("/")[-1]
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            output_file = f"AIæª¢æ ¸å ±å‘Š_{case_name}_{timestamp}.txt"
        
        lines = []
        lines.append(f"æª”åï¼šAIæª¢æ ¸å ±å‘Š_{result['æ¡ˆä»¶è³‡è¨Š']['è³‡æ–™å¤¾'].split('/')[-1]}")
        lines.append(f"æª¢æ ¸æ—¥æœŸï¼š{datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}")
        lines.append(f"ä½¿ç”¨æ¨¡å‹ï¼š{result['æ¡ˆä»¶è³‡è¨Š']['ä½¿ç”¨æ¨¡å‹']}")
        lines.append(f"ç³»çµ±ç‰ˆæœ¬ï¼šAIæ™ºèƒ½å¯©æ ¸ç³»çµ± V2.0")
        lines.append("")
        
        # æå–çš„è³‡æ–™
        å…¬å‘Š = result.get("AIæå–è³‡æ–™", {}).get("æ‹›æ¨™å…¬å‘Š", {})
        é ˆçŸ¥ = result.get("AIæå–è³‡æ–™", {}).get("æŠ•æ¨™é ˆçŸ¥", {})
        
        # 23é …æª¢æ ¸ï¼ˆä½¿ç”¨æ¨™æº–æ ¼å¼ï¼‰
        lines.append("é …æ¬¡1ï¼šæ¡ˆè™Ÿæ¡ˆåä¸€è‡´æ€§")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šæ¡ˆè™Ÿ {å…¬å‘Š.get('æ¡ˆè™Ÿ', 'N/A')}ï¼Œæ¡ˆåã€Œ{å…¬å‘Š.get('æ¡ˆå', 'N/A')}ã€")
        lines.append(f"  - é ˆçŸ¥ï¼šæ¡ˆè™Ÿ {é ˆçŸ¥.get('æ¡ˆè™Ÿ', 'N/A')}ï¼Œæ¡ˆåã€Œ{é ˆçŸ¥.get('æ¡è³¼æ¨™çš„åç¨±', 'N/A')}ã€")
        if å…¬å‘Š.get('æ¡ˆè™Ÿ') != é ˆçŸ¥.get('æ¡ˆè™Ÿ'):
            lines.append(f"  - æª¢æ ¸ï¼šâŒ ä¸ä¸€è‡´ - æ¡ˆè™Ÿå·®ç•°")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡2ï¼šå…¬é–‹å–å¾—å ±åƒ¹é‡‘é¡ç¯„åœèˆ‡è¨­å®š")
        lines.append("")
        æ¡è³¼é‡‘é¡ = å…¬å‘Š.get('æ¡è³¼é‡‘é¡', 0)
        if isinstance(æ¡è³¼é‡‘é¡, str):
            æ¡è³¼é‡‘é¡ = int(æ¡è³¼é‡‘é¡.replace(',', ''))
        é‡‘é¡_è¬ = æ¡è³¼é‡‘é¡ // 10000 if æ¡è³¼é‡‘é¡ else 0
        åœ¨ç¯„åœ = "âœ…" if 15 <= é‡‘é¡_è¬ < 150 else "âŒ"
        lines.append(f"  - å…¬å‘Šï¼šæ¡è³¼é‡‘é¡ NT${æ¡è³¼é‡‘é¡:,}ï¼ˆ{é‡‘é¡_è¬}è¬ï¼‰{åœ¨ç¯„åœ}")
        lines.append(f"  - é ˆçŸ¥ï¼šå‹¾é¸ã€Œé€¾å…¬å‘Šé‡‘é¡ååˆ†ä¹‹ä¸€ã€{é ˆçŸ¥.get('ç¬¬3é»é€¾å…¬å‘Šé‡‘é¡ååˆ†ä¹‹ä¸€', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼š{åœ¨ç¯„åœ} {'é€šé' if åœ¨ç¯„åœ=='âœ…' else 'é‡‘é¡è¶…å‡ºç¯„åœ'}")
        lines.append("")
        
        lines.append("é …æ¬¡3ï¼šå…¬é–‹å–å¾—å ±åƒ¹é ˆçŸ¥è¨­å®š")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šæ‹›æ¨™æ–¹å¼ã€Œå…¬é–‹å–å¾—å ±åƒ¹æˆ–ä¼åŠƒæ›¸æ‹›æ¨™ã€")
        lines.append(f"  - é ˆçŸ¥ï¼šå‹¾é¸ç‹€æ…‹ {é ˆçŸ¥.get('ç¬¬5é»é€¾å…¬å‘Šé‡‘é¡ååˆ†ä¹‹ä¸€', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡4ï¼šæœ€ä½æ¨™è¨­å®š")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šæ±ºæ¨™æ–¹å¼ã€Œ{å…¬å‘Š.get('æ±ºæ¨™æ–¹å¼', 'N/A')}ã€")
        lines.append(f"  - é ˆçŸ¥ï¼šæœ€ä½æ¨™å‹¾é¸ {é ˆçŸ¥.get('ç¬¬59é»æœ€ä½æ¨™', 'N/A')}")
        if å…¬å‘Š.get('æ±ºæ¨™æ–¹å¼') == 'æœ€é«˜æ¨™':
            lines.append(f"  - æª¢æ ¸ï¼šâŒ ä¸ä¸€è‡´ - æ±ºæ¨™æ–¹å¼çŸ›ç›¾")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡5ï¼šåº•åƒ¹è¨­å®š")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œè¨‚æœ‰åº•åƒ¹ã€{å…¬å‘Š.get('è¨‚æœ‰åº•åƒ¹', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šå‹¾é¸ã€Œè¨‚åº•åƒ¹ã€{é ˆçŸ¥.get('ç¬¬6é»è¨‚åº•åƒ¹', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡6ï¼šéè¤‡æ•¸æ±ºæ¨™")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œè¤‡æ•¸æ±ºæ¨™ã€{å…¬å‘Š.get('è¤‡æ•¸æ±ºæ¨™', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šç„¡çŸ›ç›¾è¨­å®š")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡7ï¼š64æ¢ä¹‹2")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œä¾64æ¢ä¹‹2ã€{å…¬å‘Š.get('ä¾64æ¢ä¹‹2', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šå‹¾é¸ç‹€æ…‹ {é ˆçŸ¥.get('ç¬¬59é»é64æ¢ä¹‹2', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡8ï¼šæ¨™çš„åˆ†é¡ä¸€è‡´æ€§")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šæ¨™çš„åˆ†é¡ã€Œ{å…¬å‘Š.get('æ¨™çš„åˆ†é¡', 'N/A')}ã€")
        lines.append(f"  - é ˆçŸ¥ï¼šè²¡ç‰©æ€§è³ªã€Œ{é ˆçŸ¥.get('è²¡ç‰©æ€§è³ª', 'N/A')}ã€")
        if å…¬å‘Š.get('æ¨™çš„åˆ†é¡') != é ˆçŸ¥.get('è²¡ç‰©æ€§è³ª'):
            lines.append(f"  - æª¢æ ¸ï¼šâŒ åš´é‡ä¸ä¸€è‡´ - æ¡è³¼æ€§è³ªæ ¹æœ¬ä¸åŒ")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡9ï¼šæ¢ç´„å”å®šé©ç”¨")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œé©ç”¨æ¢ç´„ã€{å…¬å‘Š.get('é©ç”¨æ¢ç´„', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šæ¢ç´„å”å®šå‹¾é¸ {é ˆçŸ¥.get('ç¬¬8é»æ¢ç´„å”å®š', 'N/A')}")
        if å…¬å‘Š.get('é©ç”¨æ¢ç´„') == 'å¦' and é ˆçŸ¥.get('ç¬¬8é»æ¢ç´„å”å®š') == 'å·²å‹¾é¸':
            lines.append(f"  - æª¢æ ¸ï¼šâŒ ä¸ä¸€è‡´ - æ¢ç´„é©ç”¨æ€§çŸ›ç›¾")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡10ï¼šæ•æ„Ÿæ€§æ¡è³¼")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œæ•æ„Ÿæ€§æ¡è³¼ã€{å…¬å‘Š.get('æ•æ„Ÿæ€§æ¡è³¼', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šæ•æ„Ÿæ€§å‹¾é¸ {é ˆçŸ¥.get('ç¬¬13é»æ•æ„Ÿæ€§', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šç¦æ­¢å¤§é™¸ {é ˆçŸ¥.get('ç¬¬8é»ç¦æ­¢å¤§é™¸', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâš ï¸ éœ€ç¢ºèªæ•æ„Ÿæ€§è¨­å®šä¸€è‡´æ€§")
        lines.append("")
        
        lines.append("é …æ¬¡11ï¼šåœ‹å®‰æ¡è³¼")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œåœ‹å®‰æ¡è³¼ã€{å…¬å‘Š.get('åœ‹å®‰æ¡è³¼', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šåœ‹å®‰å‹¾é¸ {é ˆçŸ¥.get('ç¬¬13é»åœ‹å®‰', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡12ï¼šå¢è³¼æ¬Šåˆ©")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œå¢è³¼æ¬Šåˆ©ã€{å…¬å‘Š.get('å¢è³¼æ¬Šåˆ©', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šä¿ç•™å¢è³¼ {é ˆçŸ¥.get('ç¬¬7é»ä¿ç•™å¢è³¼', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šæœªä¿ç•™å¢è³¼ {é ˆçŸ¥.get('ç¬¬7é»æœªä¿ç•™å¢è³¼', 'N/A')}")
        if å…¬å‘Š.get('å¢è³¼æ¬Šåˆ©') == 'æ˜¯' and é ˆçŸ¥.get('ç¬¬7é»æœªä¿ç•™å¢è³¼') == 'å·²å‹¾é¸':
            lines.append(f"  - æª¢æ ¸ï¼šâŒ ä¸ä¸€è‡´ - å¢è³¼æ¬Šåˆ©è¨­å®šçŸ›ç›¾")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡13ï¼šç‰¹æ®Šæ¡è³¼")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œç‰¹æ®Šæ¡è³¼ã€{å…¬å‘Š.get('ç‰¹æ®Šæ¡è³¼', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šéç‰¹æ®Šæ¡è³¼ {é ˆçŸ¥.get('ç¬¬4é»éç‰¹æ®Šæ¡è³¼', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡14ï¼šçµ±åŒ…")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œçµ±åŒ…ã€{å…¬å‘Š.get('çµ±åŒ…', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šéçµ±åŒ… {é ˆçŸ¥.get('ç¬¬35é»éçµ±åŒ…', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡15ï¼šå”å•†æªæ–½")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œå”å•†æªæ–½ã€{å…¬å‘Š.get('å”å•†æªæ–½', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šä¸å”å•† {é ˆçŸ¥.get('ç¬¬54é»ä¸å”å•†', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡16ï¼šé›»å­é ˜æ¨™")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œé›»å­é ˜æ¨™ã€{å…¬å‘Š.get('é›»å­é ˜æ¨™', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šé›»å­é ˜æ¨™ {é ˆçŸ¥.get('ç¬¬9é»é›»å­é ˜æ¨™', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡17ï¼šæŠ¼æ¨™é‡‘")
        lines.append("")
        å…¬å‘ŠæŠ¼æ¨™é‡‘ = å…¬å‘Š.get('æŠ¼æ¨™é‡‘', 0)
        é ˆçŸ¥æŠ¼æ¨™é‡‘ = é ˆçŸ¥.get('æŠ¼æ¨™é‡‘é‡‘é¡', 0)
        lines.append(f"  - å…¬å‘Šï¼šæŠ¼æ¨™é‡‘ã€Œæ–°è‡ºå¹£{å…¬å‘ŠæŠ¼æ¨™é‡‘:,}å…ƒã€")
        lines.append(f"  - é ˆçŸ¥ï¼šæŠ¼æ¨™é‡‘ã€Œæ–°è‡ºå¹£{é ˆçŸ¥æŠ¼æ¨™é‡‘}å…ƒã€")
        if å…¬å‘ŠæŠ¼æ¨™é‡‘ != é ˆçŸ¥æŠ¼æ¨™é‡‘ and é ˆçŸ¥æŠ¼æ¨™é‡‘ is not None:
            lines.append(f"  - æª¢æ ¸ï¼šâŒ ä¸ä¸€è‡´ - é‡‘é¡å·®ç•°")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡18ï¼šèº«éšœå„ªå…ˆ")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œå„ªå…ˆèº«éšœã€{å…¬å‘Š.get('å„ªå…ˆèº«éšœ', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šèº«éšœå„ªå…ˆ {é ˆçŸ¥.get('ç¬¬59é»èº«éšœå„ªå…ˆ', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡19ï¼šå¤–åœ‹å» å•†æ–‡ä»¶")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œå¤–åœ‹å» å•†ã€{å…¬å‘Š.get('å¤–åœ‹å» å•†', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šæœ‰ç›¸é—œæ–‡ä»¶è¦æ±‚è¦å®š")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡20ï¼šå¤–åœ‹å» å•†åƒèˆ‡")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œå¤–åœ‹å» å•†ã€{å…¬å‘Š.get('å¤–åœ‹å» å•†', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šå¯åƒèˆ‡ {é ˆçŸ¥.get('ç¬¬8é»å¯åƒèˆ‡', 'N/A')}")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡21ï¼šä¸­å°ä¼æ¥­")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šã€Œé™å®šä¸­å°ä¼æ¥­ã€{å…¬å‘Š.get('é™å®šä¸­å°ä¼æ¥­', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šå¤–åœ‹å» å•†å¯åƒèˆ‡ï¼ˆä¸€è‡´è¨­å®šï¼‰")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡22ï¼šå» å•†è³‡æ ¼")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šåˆæ³•è¨­ç«‹ç™»è¨˜ä¹‹å» å•†")
        lines.append(f"  - é ˆçŸ¥ï¼šæœ‰è³‡æ ¼è¦æ±‚è¦å®š")
        lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        lines.append("é …æ¬¡23ï¼šé–‹æ¨™ç¨‹åº")
        lines.append("")
        lines.append(f"  - å…¬å‘Šï¼šé–‹æ¨™æ–¹å¼ã€Œ{å…¬å‘Š.get('é–‹æ¨™æ–¹å¼', 'N/A')}ã€")
        lines.append(f"  - é ˆçŸ¥ï¼šä¸åˆ†æ®µ {é ˆçŸ¥.get('ç¬¬42é»ä¸åˆ†æ®µ', 'N/A')}")
        lines.append(f"  - é ˆçŸ¥ï¼šåˆ†äºŒæ®µ {é ˆçŸ¥.get('ç¬¬42é»åˆ†äºŒæ®µ', 'N/A')}")
        if é ˆçŸ¥.get('ç¬¬42é»ä¸åˆ†æ®µ') == 'å·²å‹¾é¸' and é ˆçŸ¥.get('ç¬¬42é»åˆ†äºŒæ®µ') == 'å·²å‹¾é¸':
            lines.append(f"  - æª¢æ ¸ï¼šâŒ é‚è¼¯çŸ›ç›¾ - åŒæ™‚å‹¾é¸å…©ç¨®é–‹æ¨™æ–¹å¼")
        else:
            lines.append(f"  - æª¢æ ¸ï¼šâœ… é€šé")
        lines.append("")
        
        # AIæª¢æ ¸ç¸½çµ
        if "AIæª¢æ ¸çµæœ" in result and "ç¸½çµ" in result["AIæª¢æ ¸çµæœ"]:
            ç¸½çµ = result["AIæª¢æ ¸çµæœ"]["ç¸½çµ"]
            lines.append("=" * 50)
            lines.append("AIæ™ºèƒ½æª¢æ ¸ç¸½çµ")
            lines.append("=" * 50)
            lines.append(f"é€šéé …æ•¸ï¼š{ç¸½çµ.get('é€šéé …æ•¸', 'N/A')}")
            lines.append(f"å¤±æ•—é …æ•¸ï¼š{ç¸½çµ.get('å¤±æ•—é …æ•¸', 'N/A')}")
            lines.append(f"é€šéç‡ï¼š{ç¸½çµ.get('é€šéç‡', 'N/A')}")
            lines.append(f"é¢¨éšªç­‰ç´šï¼š{ç¸½çµ.get('é¢¨éšªç­‰ç´š', 'N/A')}")
            
            if ç¸½çµ.get('ä¸»è¦å•é¡Œ'):
                lines.append("\nä¸»è¦å•é¡Œï¼š")
                for problem in ç¸½çµ['ä¸»è¦å•é¡Œ']:
                    lines.append(f"  - {problem}")
            
            if ç¸½çµ.get('å»ºè­°'):
                lines.append(f"\nå»ºè­°ï¼š{ç¸½çµ['å»ºè­°']}")
        
        # å„²å­˜æª”æ¡ˆ
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write('\n'.join(lines))
        
        print(f"ğŸ“„ AIæª¢æ ¸å ±å‘Šå·²å„²å­˜: {output_file}")
        return output_file

# ä½¿ç”¨ç¯„ä¾‹
def main():
    """ä¸»ç¨‹å¼"""
    # å»ºç«‹AIå¯©æ ¸ç³»çµ±
    ai_system = AITenderAuditSystemV2()
    
    # å¯©æ ¸æ¡ˆä»¶
    case_folder = "/Users/ada/Desktop/ollama/C14A01070"
    result = ai_system.audit_tender_case(case_folder)
    
    # è¼¸å‡ºå ±å‘Š
    if "éŒ¯èª¤" not in result:
        # å­˜å›åŸè³‡æ–™å¤¾
        import os
        report_filename = 'AIæª¢æ ¸å ±å‘Š_C14A01070.txt'
        report_path = os.path.join(case_folder, report_filename)
        ai_system.export_ai_report(result, report_path)
        
        # åŒæ™‚å„²å­˜JSON
        json_filename = 'AIæª¢æ ¸çµæœ_C14A01070.json'
        json_path = os.path.join(case_folder, json_filename)
        with open(json_path, 'w', encoding='utf-8') as f:
            json.dump(result, f, ensure_ascii=False, indent=2)
        
        print(f"\nâœ… å ±å‘Šå·²å­˜å›è³‡æ–™å¤¾ï¼š{case_folder}")
    else:
        print(f"âŒ å¯©æ ¸å¤±æ•—: {result['éŒ¯èª¤']}")

if __name__ == "__main__":
    main()